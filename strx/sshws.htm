<%+header%>
<%
  -- Tentukan status sambungan
  local is_connected = not (cfg.wan_ip:find("Failed") or cfg.wan_ip:find("Check"))
  local status_class = is_connected and "is-connected" or "is-disconnected"
  
  -- Ambil pemboleh ubah log dari lua controller
  local log_content = log_content or "Loading log..."
  local log_lines = log_lines or 25
  local log_file = log_file or "/var/log/sshws.log"
%>
<style>
  /* --- Gaya Asas --- */
  .sshws-section { background: #1a1a1f; padding: 20px; border-radius: 12px; color: #eee; }
  .sshws-section h2 { color: #00e0c7; }
  .sshws-field { margin-bottom: 12px; }
  .sshws-label { font-weight: 600; display: block; margin-bottom: 4px; }
  input[type=text], input[type=number], input[type=password], textarea {
    width: 100%; padding: 8px; border-radius: 6px; border: 1px solid #333; background: #222; color: #fff;
  }
  .btn { padding: 8px 16px; border: none; border-radius: 6px; cursor: pointer; margin-right: 6px; }
  .btn-save { background: #00c4a7; color: white; }
  .btn-reload { background: #0077cc; color: white; }
  .btn-start { background: #28a745; color: white; }
  .btn-stop { background: #dc3545; color: white; }
  .btn:hover { opacity: 0.85; }
  .message { margin-bottom: 15px; padding: 10px; border-radius: 6px; background: #222; color: #0f0; }

  /* --- Gaya Network Information --- */
  .network-status-box {
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 15px;
    border: 1px solid transparent; /* Asas */
  }

  /* KONDISI: ADA INTERNET (HIJAU + BEATING LIGHT) */
  .is-connected {
    background-color: #0d3b36; /* Hijau gelap sebagai asas */
    border-color: #00e0c7;
    animation: pulse 2s infinite; /* Animasi diterapkan di sini */
  }
  .is-connected .wan-ip, .is-connected .isp-name {
    color: #00ffaa; /* Hijau muda/mint */
  }

  /* KONDISI: TIADA INTERNET (MERAH/PINK) */
  .is-disconnected {
    background-color: #4d001a; /* Merah gelap/Maroon sebagai asas */
    border-color: #ff6347; /* Tomato Red/Pinkish */
  }
  .is-disconnected .wan-ip, .is-disconnected .isp-name {
    color: #ff9999; /* Pink muda/Merah muda */
  }
  
  /* Styling IP dan ISP */
  .wan-data {
      display: flex;
      justify-content: space-between;
      gap: 20px;
  }
  .data-field {
      flex: 1;
      padding: 5px 0;
  }
  .wan-ip, .isp-name {
      font-weight: 700;
      font-size: 1.1em;
      display: block;
      margin-top: 2px;
  }
  /* Gaya Log */
  .log-textarea {
      font-family: monospace; 
      background: #0c0c10; 
      color: #00ffaa; 
      border: 1px solid #333; 
      padding: 10px; 
      overflow-y: scroll;
      /* Penting untuk memaparkan format baris log dengan betul */
      white-space: pre; 
  }

  /* --- Keyframes untuk Animasi "Beating Light" --- */
  @keyframes pulse {
    0% {
      box-shadow: 0 0 0 0 rgba(0, 255, 170, 0.5); /* Hijau muda */
    }
    70% {
      box-shadow: 0 0 0 10px rgba(0, 255, 170, 0);
    }
    100% {
      box-shadow: 0 0 0 0 rgba(0, 255, 170, 0);
    }
  }
</style>

<div class="sshws-section">
  <h2>SSHWS by STRX</h2>

  <% if message then %>
    <div class="message"><%=message%></div>
  <% end %>

  <fieldset class="sshws-field network-status-box <%=status_class%>">
    <legend><b>Network sshws status üåê</b></legend>
    
    <div class="wan-data">
        <div class="data-field">
            <span class="sshws-label">WAN IP</span>
            <span class="wan-ip"><%=cfg.wan_ip or 'Loading...'%></span>
        </div>
        <div class="data-field">
            <span class="sshws-label">ISP</span>
            <span class="isp-name"><%=cfg.isp_name or 'Loading...'%></span>
        </div>
    </div>
  </fieldset>
  <form method="post" action="<%=url('admin/services/sshws')%>">
    <div class="sshws-field">
      <span class="sshws-label">Proxy Host</span>
      <input type="text" name="proxyHost" value="<%=cfg.proxyHost or ''%>">
    </div>
    <div class="sshws-field">
      <span class="sshws-label">Proxy Port</span>
      <input type="number" name="proxyPort" value="<%=cfg.proxyPort or ''%>">
    </div>

    <fieldset class="sshws-field">
      <legend><b>SSH Configuration</b></legend>
      <div class="sshws-field">
        <span class="sshws-label">Host</span>
        <input type="text" name="ssh_host" value="<%=cfg.ssh and cfg.ssh.host or ''%>">
      </div>
      <div class="sshws-field">
        <span class="sshws-label">Port</span>
        <input type="number" name="ssh_port" value="<%=cfg.ssh and cfg.ssh.port or ''%>">
      </div>
      <div class="sshws-field">
        <span class="sshws-label">Username</span>
        <input type="password" name="ssh_username" value="<%=cfg.ssh and cfg.ssh.username or ''%>">
      </div>
      <div class="sshws-field">
        <span class="sshws-label">Password</span>
        <input type="password" name="ssh_password" value="<%=cfg.ssh and cfg.ssh.password or ''%>">
      </div>
    </fieldset>

    <div class="sshws-field">
      <span class="sshws-label">HTTP Payload</span>
      <textarea rows="4" name="httpPayload"><%=cfg.httpPayload or ''%></textarea>
    </div>

    <div class="sshws-field">
      <span class="sshws-label">Connection Timeout</span>
      <input type="number" name="connectionTimeout" value="<%=cfg.connectionTimeout or ''%>">
    </div>
    
    <fieldset class="sshws-field" style="margin-top:20px;">
      <legend><b>Service Log (Last <%=log_lines%> lines) üìú</b></legend>
      <textarea readonly rows="12" class="log-textarea" style="width: 100%;"><%=log_content or ''%></textarea>
      <p style="font-size: 0.85em; color: #888;">Log file: <%=log_file%></p>
    </fieldset>
    <div style="margin-top:20px;">
      <button class="btn btn-reload" name="action" value="reload">Refresh Status & Log</button>
      <button class="btn btn-save" name="action" value="save">Save</button>
      <button class="btn btn-start" name="action" value="start">‚ñ∂Ô∏è Start</button>
      <button class="btn btn-stop" name="action" value="stop">Stop</button>
    </div>
  </form>
</div>

<%+footer%>
