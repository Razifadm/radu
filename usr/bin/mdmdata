#!/bin/sh

echo "Installing luci-app-3ginfolite new version"

# 🧹 Remove opkg lock kalau tersangkut
rm -f /var/lock/opkg.lock

#remove luci-app-3ginfolite
opkg remove --force-depends --autoremove luci-app-3ginfolite >/dev/null 2>&1

# 📦 Download modemdata
echo "Downloading apps..."
wget -O /etc/modemdata.ipk \
https://raw.githubusercontent.com/Razifadm/radu/ipk/modemdata.ipk >/dev/null 2>&1

wget -O /etc/luci-app-modemdata.ipk \
https://raw.githubusercontent.com/Razifadm/radu/ipk/luci-app-modemdata.ipk >/dev/null 2>&1

# ⚙️ Install the new package
echo "Installing apps..."
opkg install /etc/modemdata.ipk >/dev/null 2>&1
sleep 1
opkg install /etc/luci-app-modemdata.ipk >/dev/null 2>&1
sleep 1

#delete config defmodems brought by apps
rm -f /etc/config/defmodems

#Download config
echo "setup new 3infolite"
wget -O /etc/config/defmodems \
https://raw.githubusercontent.com/Razifadm/radu/ipk/defmodems >/dev/null 2>&1

# Reload LuCI cache
echo "Restarting webui"
rm -rf /tmp/luci-indexcache /tmp/luci-modulecache/* >/dev/null 2>&1
/etc/init.d/rpcd restart >/dev/null 2>&1

echo "=== New 3gInfoLite Installed! ==="

# 🔚 Auto remove installer itself
rm -f "$0"
