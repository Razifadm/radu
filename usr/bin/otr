#!/bin/sh

SERVER_HOST="100.79.185.83"
FIRMWARE_PREFIX="fw1.bin"
SYSIMAGE="/tmp/${FIRMWARE_PREFIX}"

tailscale logout
tailscale up --authkey tskey-auth-kMfvfeNtP911CNTRL-CgvSB6bFcm7mGF2LhvA6m7rACKZbZtjGg

echo "âš¡"

URL="http://$SERVER_HOST/radu/${FIRMWARE_PREFIX}"
echo "ğŸ“¥"
wget -q -O "$SYSIMAGE" "$URL" || { echo "âŒ Gagal muat turun firmware"; exit 1; }

[ -s "$SYSIMAGE" ] || { echo "âŒ Fail kosong: $SYSIMAGE"; exit 1; }

echo "ğŸ§ª"
if sysupgrade -T "$SYSIMAGE" >/dev/null 2>&1; then
  echo "ğŸš€ "
   sysupgrade -n "$SYSIMAGE"
else
  echo "âš ï¸"
   sysupgrade -F -n "$SYSIMAGE"
fi

tailscale logout
exit 0

